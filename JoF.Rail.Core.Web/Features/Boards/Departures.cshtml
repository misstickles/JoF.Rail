@model JoF.Rail.Standard.Models.LiveDepartureBoard.Result.StationBoardModel

@{
    var orderedServices = Model.Services.OrderBy(s => (s.ScheduledTimeDeparture ?? s.ScheduledTimeArrival));

    <div class="container">
        <div class="row align-content-center">
            <div class="col-4">
                <h2>Departures</h2>
            </div>
            <div class="col-8 text-right">
                @{
                    var parms = new Dictionary<string, string>
                    {
                        { "crs", Model.Crs },
                        { "filterCrs", Model.FilterCrs },
                    };
                }
                <a class="btn btn-primary d-none d-sm-inline" asp-action="Arrivals" asp-all-route-data="parms">Arrivals</a>
                <a class="btn btn-primary d-sm-none" asp-action="Arrivals" asp-all-route-data="parms">Arrs</a>
                @if (Model.FilterCrs != null)
                {
                    <a class="btn btn-primary d-none d-sm-inline" asp-action="Fastest" asp-all-route-data="parms">Fastest</a>
                    <a class="btn btn-primary d-sm-none" asp-action="Fastest" asp-all-route-data="parms">Fast</a>
                }
                <a class="btn btn-primary d-none d-sm-inline" asp-action="Index">Change Station</a>
                <a class="btn btn-primary d-sm-none" asp-action="Index"><i class="fas fa-map-marker-alt"></i></a>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <h3>
                    from @Model.Location
                    @if (Model.FilterLocation != null)
                    {
                        <span>via @Model.FilterLocation</span>
                    }
                </h3>
            </div>
        </div>
    </div>

    <div class="container bg-danger text-white">
        <div class="row">
            @foreach (var message in Model.Messages)
            {
                <div class="col-12 py-2">@Html.Raw(message)</div>
            }
        </div>
    </div>

    <div class="container departure-board">
        <div class="row align-items-center py-3">
            <div class="col-2 text-center d-none d-sm-block"><strong>Departs</strong></div>
            <div class="col-3 d-none d-sm-block"><strong>Destination</strong></div>
            <div class="col-2 text-center d-none d-sm-block"><strong>Expected</strong></div>
            <div class="col-1 text-center d-none d-sm-block"><strong>Delay</strong></div>
            <div class="col-1 text-center d-none d-sm-block"><strong>Plat</strong></div>
            <div class="col-1 text-center d-none d-sm-block"><strong>Coaches</strong></div>
        </div>
        <div class="row align-items-center d-sm-none">
            <div class="col-2 text-center d-sm-none"><strong>Dep</strong></div>
            <div class="col-3 d-sm-none"><strong>Dest</strong></div>
            <div class="col-2 text-center d-sm-none"><strong>Exp</strong></div>
            <div class="col-1 text-center d-sm-none"><i class="fas fa-clock"></i></div>
            <div class="col-1 text-center d-sm-none"><strong>P</strong></div>
            <div class="col-1 text-center d-sm-none"><strong>#</strong></div>
        </div>

        @foreach (var service in Model.Services)
        {
            <div class="row pb-2 align-items-center">
                <div class="col-2 text-center">@service.ScheduledTimeDeparture</div>
                <div class="col-3">
                    @foreach (var dest in service.Destinations)
                    {
                        <div class="d-block">@dest.Location</div>
                        @if (dest.Via != null)
                        {
                            <small class="indent d-none d-sm-block">
                                @dest.Via
                            </small>
                        }
                    }
                </div>
                <div class="col-2 text-center">@service.EstimatedTimeDeparture</div>
                <div class="col-1 text-center">@service.EstimatedTimeDepartureDelay</div>
                <div class="col-1 text-center">@service.Platform</div>
                <div class="col-1 text-center">@service.TrainLength</div>
                <div class="col-1 text-center">
                    <button class="btn btn-dark" data-toggle="collapse" data-target="#@service.Guid" aria-expanded="false" aria-controls="collapseExample">
                        <i class="fas fa-info"></i>
                    </button>
                </div>
            </div>

            @if (service.DelayReason != null || service.CancellationReason != null)
            {
                <div class="row pb-2 align-items-center">
                    <div class="col offset-sm-1 text-danger">
                        @if (service.DelayReason != null && service.CancellationReason == null)
                        {
                            @service.DelayReason
                        }
                        @if (service.CancellationReason != null)
                        {
                            @service.CancellationReason
                        }
                    </div>
                </div>
            }

            @if (service.IsFilterLocationCancelled)
            {
                <div class="row pb-2 align-items-center">
                    <div class="col offset-sm-1 text-danger">
                        <p class="text-danger">No longer stopping at destination</p>
                    </div>
                </div>
            }

            <div class="collapse" id="@service.Guid">
                @{
                    ViewData["Here"] = Model.Location;
                    ViewData["There"] = Model.FilterLocation;
                }
                <partial name="_TrainServiceDetails" model="service" , view-data="ViewData" />
            </div>
        }

        <small class="row py-3">
            <div class="col text-right">@Model.GeneratedAt</div>
        </small>

        <small class="row d-sm-none pb-3">
            <div class="col">
                <i class="fas fa-clock"></i> - Delay, minutes
                <div>P - Platform number</div>
                <div># - Number of coaches</div>
            </div>
        </small>

    </div>
}

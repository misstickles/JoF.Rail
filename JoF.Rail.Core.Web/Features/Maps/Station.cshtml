@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@

<h2>Station Map</h2>

<div id="stationMap" class="w-100">&nbsp;</div>

@section Scripts {
    <script>
        var map;
        function mapStations() {
            $.ajax({
                context: this,
                url: "/api/StationMapMarkers/All",
                dataType: "json",
                success: function (data) {
                    var hhe = { lat: 51.00525294, lng: -0.105306765 };

                    var myOptions = {
                        center: hhe,
                        zoom: 10
                    };

                    map = new google.maps.Map(document.getElementById("stationMap"), myOptions);

                    var transitLayer = new google.maps.TransitLayer();
                    transitLayer.setMap(map);

                    var markers = data.stations.map(function (location, i) {
                        var marker = new google.maps.Marker({
                            position: new google.maps.LatLng(location.latitude, location.longitude),
                            animation: google.maps.Animation.DROP,
                            title: location.name
                        });

                        var infoWindow = new google.maps.InfoWindow({
                            content: "<p><strong>" + location.name + "</strong><br/>Location: " + marker.getPosition() + "</p>"
                        });

                        google.maps.event.addListener(marker, "click", function () {
                            infoWindow.open(map, marker);
                        });

                        return marker;
                    });

                    var markerCluster = new MarkerClusterer(map, markers,
                        {
                            imagePath: "../images/m",
                            maxZoom: 10
                        });
                },
                error: function (data, type) {
                    alert("Error");
                }
            });
        }

    </script>
    <script src="~/dist/js/markerclusterer.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyByDpDMpyj8fERUwwsFy09BLSyBu2Rmm-U&callback=mapStations"
            async defer></script>
}
